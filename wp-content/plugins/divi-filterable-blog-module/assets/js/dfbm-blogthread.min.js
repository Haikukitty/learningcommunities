"use strict";!function($,t){$(function(){var e=function t(e){this.init(e)};$.extend(e.prototype,{init:function t(e){this.vars(),this.events(),this.load()},vars:function e(){this.state={},this.noURL=!1,this.posts=!1,this.headH=this.header(),this.width=$(t).width(),this.navBar=$("#dfbm-cat-nav"),this.active=$("#dfbm-active-cat"),this.parent=$("#dfbm-container"),this.feat=this.parent.children("div.et_pb_featured_posts"),this.blog=this.parent.children("div.filterable-blogposts"),this.grid=!!this.parent.hasClass("grid"),this.full=!!this.parent.hasClass("full"),this.cCol=parseInt(dfbmPhp.cMax),this.cWid=parseInt(dfbmPhp.cWidth),this.cDist=parseInt(dfbmPhp.cDist),this.mWid=this.cWid/this.cCol,this.lBase=dfbmPhp.lBase,this.lStart=this.lBase,this.lCurr=this.lBase,this.lAjax=this.lBase,this.nonce=dfbmPhp.nonce,this.url=dfbmPhp.url,this.body=$("body"),this.shop=!!this.body.hasClass("woocommerce"),this.search=!!this.body.hasClass("search"),this.author=!!this.body.hasClass("author"),this.lb="on"==dfbmPhp.ltBox},load:function t(){var e,i=this,s=this.getHistoryObj();this.removeSession("dfbmLoaded"),!s||null==s.state.addMore||this.getSession("dfbmRedirect")&&s.curr!=s.base||this.setSession("dfbmAddMore",!0),this.getSession("dfbmRedirect")&&!this.getSession("dfbmAddMore")&&this.blog.children("article").addClass("redirect"),s||(this.posts=this.normalizePosts(this.blog.children("article"))),e=this.imagesToLoad(this.posts?this.posts:s.state.content.posts),this.load.callback=function(){i.width>767&&(i.feat&&i.featured(),i.full&&i.fullwidth()),i.grid?i.videoWidth():i.blog.trigger("blogs-loaded"),i.catNavSubmenu(),i.catNavAddParent(),i.catNavPadding()},this.interval(e,this.load.callback)},masonry:function t(){this.blog.mosaicflow({columnClass:"article-col",itemSelector:"article",minItemWidth:this.cWid/this.cCol,itemHeightCalculation:"auto",minColumns:1})},featured:function t(){var e=this,i=this.feat.find("img");this.featured.callback=function(){switch(e.feat.data("count")){case 2:var t,i=e.feat.find("article"),s=(t=(i.eq(0).height()+i.eq(1).height())/2<350)?350:t;i.hasClass("format-gallery")&&i.find("div.et_pb_slide").css("height",s);break;case 3:var a,n=e.feat.find("div.right"),t=n.height(),o=n.siblings("div").children("article");e.getElements(o).css({height:t+1,maxHeight:t+1});break}},this.interval(i,this.featured.callback)},fullwidth:function t(){var e=this.blog.children("article"),i=e.width(),s=this;e.each(function(){var t=$(this).children().children();if(t.length<2)t.css("width","100%");else{var e=$(this).find("div.et_pb_content_container"),a=s.width>767?400:350,n=e.css("minHeight",a).outerHeight();$(this).hasClass("format-gallery")&&s.initGallery($(this).find("div.et_pb_slider")),s.width>767?($(this).children().css("maxHeight",n),s.getElements($(this)).css({height:n,width:.6*i,maxWidth:.6*i})):($(this).children().removeAttr("style"),s.getElements($(this)).removeAttr("style"))}})},videoWidth:function t(e){if(!this.getSession("dfbmLoaded")){this.setSession("dfbmLoaded",!0);var i,s=this,e=e||!1,a,n,o;e?o=this.blog.children("div.article-col").first().width():(a=this.blog.outerWidth(),n=(i=Math.floor(a/this.mWid))>this.cCol?this.cCol:this.width>767&&i<2?2:i,o=a/n-this.cDist),this.blog.children("div").hasClass("no-posts")?this.blog.trigger("blogs-loaded"):this.blog.children("article.format-video").each(function(){var t,e={width:o,height:o/(16/9)},i=$(this).find("div.et_main_video_container"),s=i.children("div.wp-video");s.length>0?(s.css(e),s.find("video.wp-video-shortcode").css(e)):i.find("iframe").css(e)}).promise().done(function(){return s.masonry()})}},header:function t(){var e,t=isNaN(e=parseInt(dfbmPhp.header))?!$("body").hasClass("et_vertical_nav")&&$("#main-header").length>0&&this.width>980?$("#main-header").outerHeight():0:e;return e&&this.width<981&&(t=parseInt(dfbmPhp.mobile)),t},catNavSubmenu:function e(){var i=$(t).width()/2;this.navBar.find("ul.dfbm-sub-menu.first").each(function(){i<$(this).parent().offset().left?$(this).hasClass("left")&&$(this).addClass("right").removeClass("left"):$(this).hasClass("right")&&$(this).addClass("left").removeClass("right")})},catNavAddParent:function t(){this.navBar.find("ul.dfbm-sub-menu.first").parent().addClass("parent")},catNavPadding:function t(){this.width<768&&this.navBar.parent().hasClass("text")&&this.navBar.find("ul.dfbm-sub-menu.first").css("paddingTop",this.navBar.height()-20)},minHeight:function e(){var i=this.width>980?this.headH:0;return $(t).outerHeight()-i-this.navBar.parent().outerHeight()-$("#dfbm_blog_pagination").outerHeight()-$("#main-footer").outerHeight()+15},getElements:function t(e){return e.hasClass("format-gallery")?e.find("div.et_pb_slider, div.et_pb_slides"):e.hasClass("format-video")?e.find("div.et_pb_video_overlay, div.et_main_video_container, div.wp-video, .wp-video-shortcode, div.fluid-width-video-wrapper, iframe"):e.hasClass("format-quote")?e.find("div.et_quote_content"):e.hasClass("format-audio")?e.find("div.et_audio_content"):e.hasClass("format-link")?e.find("div.et_link_content"):e.find("img")},imagesToLoad:function t(e){var i=0,s=[],a;return $(e).each(function(){if(($(this).hasClass("format-standard")||$(this).hasClass("type-product"))&&(a=$(this).find("img")),$(this).hasClass("format-video")){var t=$(this).find("div.et_main_video_container").children("div.et_pb_video_overlay"),e=t.css("background-image");e?(e=e.trim().replace(/(url\(|\)|'|")/gi,""),a=$("<img />",{src:e})):a=$(this).find("img")}a&&a.length>0&&(s[i]=a[0],i++)}),s},interval:function t(e,i){var s=this,a=setInterval(function(){(e.length<1||s.imagesLoaded(e))&&(clearInterval(a),i())},100)},imagesLoaded:function t(e){var i=0,s=e.length;for(i;i<s;i++)if(!e[i].complete)return!1;return!0},initMediaType:function t(){var e=this,i="article.ajax-video, article.ajax-gallery, article.ajax-audio";(this.grid?e.blog.children("div").children(i):e.blog.children(i)).each(function(){$(this).hasClass("ajax-video")&&e.initVideo($(this).removeClass("ajax-video")),$(this).hasClass("ajax-audio")&&e.initAudio($(this).removeClass("ajax-audio")),$(this).hasClass("ajax-gallery")&&e.initGallery($(this).removeClass("ajax-gallery"))})},initGallery:function e(i){t.et_pb_slider_init(i.find("div.et_pb_slider"))},initVideo:function t(e){e.find("video").mediaelementplayer()},initAudio:function t(e){e.find("audio").mediaelementplayer()},normalizePosts:function t(e){var i=[];return e.length>0&&e.each(function(){i.push($(this).prop("outerHTML"))}),i},changeContent:function t(){var e,i=this;e=this.imagesToLoad(this.state.content.posts),this.changeContent.callback=function(){var t,e,s;if(i.grid){s=i.state.content.posts.length>0?i.minHeight():0,i.blog.css("minHeight",s).mosaicflow("empty");for(var a in i.state.content.posts)isNaN(parseInt(a))||i.blog.mosaicflow("add",$(i.state.content.posts[a]));t=i.videoWidth}i.full&&(e=$(i.state.content.posts.join("")),i.blog.css("minHeight",i.minHeight()).html(e),t=i.fullwidth),i.removeMore(0),i.adjustChange.call(i,t)},this.interval(e,this.changeContent.callback)},addGrid:function t(){var e,i=0,s=this,a=this.blog.children("div.article-col").first().width();null!=this.state.addMore&&(null==this.getSession("dfbmAddMore")&&this.blog.css("minHeight",this.minHeight()).removeClass("completed").mosaicflow("empty").parent().removeClass("completed"),this.state.added=!0),e=this.imagesToLoad(this.state.content.posts),this.addGrid.callback=function(){for(var t in s.state.content.posts){var e=$(s.state.content.posts[t]);if(e.hasClass("format-video")){var n=e.find("video.wp-video-shortcode, iframe"),o=n.prop("width"),r=n.prop("height"),d=o/r;n.css({width:a,height:a/d})}s.blog.mosaicflow("add",$(e)),i++}s.adjustAdded()},this.interval(e,this.addGrid.callback)},addFull:function t(){var e,i=this;null!=this.state.addMore&&(null==this.getSession("dfbmAddMore")&&this.blog.css("minHeight",this.minHeight()).removeClass("completed").empty().parent().removeClass("completed"),this.state.added=!0),e=this.imagesToLoad(this.state.content.posts),this.addFull.callback=function(){var t=$(i.state.content.posts.join(""));i.blog.append(t),i.fullwidth(),i.adjustAdded()},this.interval(e,this.addFull.callback)},initAddLayout:function t(){this.grid?this.addGrid():this.addFull()},adjustChange:function t(e){var i=this,s=!0;e.call(i,!1),this.sharedAdjustment(),this.pagination(),this.getSession("dfbmRedirect")&&(s=!1),this.changeUrl(this.lCurr,s)},adjustAdded:function t(){this.sharedAdjustment(),this.marker()},sharedAdjustment:function t(){this.initMediaType(),this.query(),this.lb&&this.unbind(),this.shop&&this.adjustWoo(),this.removeSession("dfbmLoaded")},adjustWoo:function t(){var e=$("nav.woocommerce-breadcrumb"),i=$("p.woocommerce-result-count");null!=this.state.content.breadcrumb&&e.length>0&&e.replaceWith(this.state.content.breadcrumb),null!=this.state.content.results&&i.length>0&&i.replaceWith(this.state.content.results)},pagination:function t(){var t=$("#dfbm_blog_pagination");t.length>0?t.replaceWith(this.state.content.pagination):this.parent.append(this.state.content.pagination)},removeMore:function t(e){$("#add-more-button").parent().slideUp(e,function(){$(this).remove()})},query:function t(){this.blog.data("config",this.state.query)},ajax:function t(e,i){var s=this,i=i||{},a=this.blog.data("config"),n=this.blog.data("atts"),o=$.extend({},i,{nonce:this.nonce,action:"dfbm_get_posts",option:e,base:s.lAjax,query:a,atts:n});$.ajax({type:"post",dataType:"json",url:this.url,data:o,success:function t(e){s.state=e,s.addContentCheck()},error:function t(e){console.log(e),location.reload()}})},addContentCheck:function t(){switch(this.state.case){case"category":case"paged":this.changeContent();break;case"more":this.setMarker(),this.initAddLayout();break}},animate:function e(i,s,a,n){var o,r,d=this,h=$(t).scrollTop(),l=i.offset().top-d.headH-this.cDist-("marker"==s?0:1),c="marker"==s&&null!=this.state.addMore&&this.state.added?0:(r=.2*Math.abs(h-l))<500?500:r>2500?2500:r;$("html, body").animate({scrollTop:l},c,"swing").promise().then(function(){if(a){if(s&&n)return d.setScrollPos($(t).scrollTop()),d.ajax(s,a);if("marker"==s||null!=d.state.addMore)return d.routeMarker(i);d.addContentCheck(a)}else t.location.reload()})},animateTarget:function t(e,i,s){"category"==e&&this.active&&this.changeActive(i);var a=this.navBar.length>0?this.navBar:this.blog;this.animate(a,e,i,s)},changeActive:function t(e){this.active.fadeOut(300,function(){$(this).text(e.name).fadeIn(300)}),this.navBar.find('a[data-cat-id="'+e.target+'"]').addClass("active").parent().siblings().find("a").removeClass("active")},routeMarker:function t(e){if(null!=this.state.addMore){if(!this.state.added)return this.initAddLayout();this.removeSession("dfbmAddMore"),this.state.content.pagination?this.state.content.pagination&&$("#add-more-section").length<1&&this.parent.append($(this.state.content.pagination)):this.removeMore(0),this.showContent(),this.state={}}e&&e.removeClass("marker")},marker:function t(){var e=this,i=!0,t=this.blog.find("article.marker");t.length<1&&null!=this.state.scroll&&(this.blog.trigger("adjust-scroll-top"),this.routeMarker()),null!=this.state.query&&this.state.query.paged===this.state.query.maximum_pages&&(i=!1,this.removeMore(300)),t.length>0&&this.animate(t,"marker",!0,!1),$("#add-more-button").removeClass("active"),this.changeState(i)},setMarker:function t(e,i){var s=i||0,a=e||!1,n=function t(e){return e.replace("et_pb_post","et_pb_post marker")};return a?a[i]=n(a[i]):this.state.content.posts[s]=n(this.state.content.posts[s])},deleteMarker:function t(e){var i=e.state.addMore.index,s=e.state.addMore.posts.length;return e.state.addMore.posts[s-i]=e.state.addMore.posts[s-i].replace("et_pb_post marker","et_pb_post"),e},setScrollPos:function t(e,i){var s=i||!1,a=this.getHistoryObj();null!=a.state.addMore&&null!=a.state.addMore.index&&(a.state.addMore.index>0&&(a=this.deleteMarker(a)),a.state.addMore.index=0),a.state.scroll=e||0,this.changeState(!1,a,!1,i)},initialState:function t(){var e,i=(e=$("#dfbm_blog_pagination")).length>0?e:$("#add-more-section");if(this.active?this.state.case="category":this.state.case="paged",this.navBar){var s=this.navBar.find(".cat-selector.active");this.state.name=s.data("cat-name"),this.state.target=s.data("cat-id")}if(this.state.query=this.blog.data("config"),this.state.content={},this.state.content.posts=this.posts,i.length>0&&(this.state.content.pagination=i.prop("outerHTML")),this.shop){var a=$("nav.woocommerce-breadcrumb"),n=$("p.woocommerce-result-count");a.length>0&&(this.state.content.breadcrumb=a.prop("outerHTML")),n.length>0&&(this.state.content.results=n.prop("outerHTML"))}},changeUrl:function e(i,s){if(this.noURL){var a=this.getHistoryObj();if(this.noURL=!1,a&&null!=a.curr&&a.curr!=t.location.href)return this.changeState(!1,a,!1)}else{if(this.getSession("dfbmRedirect"))return this.blog.trigger("adjust-scroll-top"),this.showContent(),this.changeState(!1,!1,!0);var a={},n=i||!1,o=s||!1;if(i||s||this.initialState(),a.base=this.lStart,a.curr=n||t.location.href,a.state=!$.isEmptyObject(this.state)>0&&this.state,this.state={},this.shop&&(a.shop=!0),this.search&&(a.search=this.getLinkParameter(location.href)),o)return t.history.pushState(JSON.stringify(a),"",n);this.changeState(!1,a)}},changeState:function e(i,s,a,n){if(this.noURL)return this.noURL=!1;var o,r=i||!1,d=s||!1;a=!(!a&&!this.getSession("dfbmRedirect")),a||d||!this.state||(d=this.buildAddMoreState(r)),this.state={},(d||a)&&(d=d||this.getHistoryObj(),d&&null!=d.curr&&(o=d.curr),this.getSession("dfbmRedirect")&&(this.removeSession("dfbmRedirect"),a=!1),t.history.replaceState(JSON.stringify(d),"",o||location.href),a&&this.checkState(),n&&t.location.assign(n))},checkState:function e(i){var s=this.getHistoryObj();if(s){if(null==s.shop&&(s.base!=this.lStart||!1===s.state)||null!=s.shop&&!1===s.state)return null!=this.lStart&&this.animateTarget(!1,!1,!1);this.state=s.state,null!=this.state.addMore&&(i&&!this.getSession("dfbmRedirect")?this.state.content.posts=this.state.addMore.posts:this.mergeStatePosts()),this.historyStep()}else this.removeSession("dfbmAddMore"),t.location.reload()},historyStep:function t(){if(this.getSession("dfbmRedirect")||(this.noURL=!0),null!=this.state.addMore&&(this.state.added=!1),this.getSession("dfbmAddMore"))return this.initAddLayout();this.animateTarget(this.state.case,this.state,!1)},getHistoryObj:function e(){var i;return!$.isEmptyObject(i=t.history.state)&&JSON.parse(i)},buildAddMoreState:function t(e){var i=this,s=this.getHistoryObj();return null!=s.state.addMore&&null!=s.state.addMore.index&&s.state.addMore.index>0?s=this.deleteMarker(s):null==s.state.addMore&&(s.state.addMore={},s.state.addMore.posts=[]),null!=s.state.scroll&&delete s.state.scroll,e||(s.state.content.pagination=""),s.state.query=this.state.query,s.state.addMore.index=this.state.content.posts.length,s.state.addMore.posts=$.merge(s.state.addMore.posts,i.state.content.posts),s},mergeStatePosts:function t(){this.state.content.posts=$.merge(this.state.content.posts,this.state.addMore.posts)},getLinkParameter:function t(e){return-1!==e.indexOf("?")?e.split("/").filter(function(t){return-1!==t.indexOf("?")})[0]:""},setSession:function e(i,s){t.sessionStorage.setItem(i,s)},getSession:function e(i){return t.sessionStorage.getItem(i)},removeSession:function e(i){t.sessionStorage.removeItem(i)},unbind:function t(){$(".et_pb_post .et_pb_video_overlay").off()},showContent:function t(){$("html.redirected").removeClass("redirected"),this.blog.addClass("completed").parent().addClass("completed")},events:function e(){var i=this;this.blog.one("adjust-scroll-top",function(){var e=i.getHistoryObj();e&&null!=e.state&&null!=e.state.scroll&&($(t).scrollTop(e.state.scroll),$("html.redirected").removeClass("redirected"))}).one("mosaicflow-filled blogs-loaded",function(t){i.getSession("dfbmAddMore")||sessionStorage.getItem("dfbmRedirect")?(i.grid&&i.getSession("dfbmAddMore")&&i.blog.find("article").css({position:"static",visibility:"visible",display:"block"}),i.checkState(!0)):("blogs-loaded"==t.type&&i.showContent(),i.lb&&i.unbind(),i.removeSession("dfbmLoaded"),i.getHistoryObj()||i.changeUrl(!1,!1))}),this.parent.on("mouseenter",".content-overlay article.hover",function(){$(this).find("div.header-before").slideDown(300)}).on("mouseleave","div.content-overlay article.hover",function(){$(this).find("div.header-before").finish().slideUp(300)}).on("click","div.et_pb_content_container.click",function(){$(this).addClass("clicked hover").removeClass("click").find("div.header-before").slideDown(300)}).on("click","div.et_pb_content_container.clicked",function(){$(this).addClass("click").removeClass("clicked hover").find("div.header-before").finish().slideUp(300)}).on("click",".entry-title a, a.et_pb_button.read-more, a.no-lb",function(e){e.stopPropagation(),e.preventDefault(),i.setScrollPos($(t).scrollTop(),$(this).prop("href"))}).on("click","div.clicked a.add_to_cart_button",function(t){t.preventDefault(),$(this).trigger("click")}).on("click","div.clicked a.wc-forward",function(t){t.stopPropagation()}).on("click","a.cat-selector",function(t){if(!(i.search&&!i.shop||i.author)){if(t.preventDefault(),i.width<768&&$(this).parent().hasClass("parent")&&!$(this).parent().hasClass("opened"))return $(this).parent().addClass("opened");var e,s,a,n={};a=i.getLinkParameter(location.href),-1!==a.indexOf("&s=")&&(a=a.split("&").filter(function(t){return-1===t.indexOf("s=")}).join("&")),i.lCurr=i.lBase=$(this).prop("href")+a,i.lAjax=i.lBase.split("?")[0]+a,n.target=$(this).data("cat-id"),n.name=$(this).data("cat-name"),(s=i.blog.data("cat-not-id"))&&(n.targetNot=s),i.navBar.children("li.parent").removeClass("opened"),i.animateTarget("category",n,!0)}}).on("click","a.page-numbers",function(t){t.preventDefault();var e,s,a={},n=$(this).prop("href");i.lCurr=n,s=i.getLinkParameter(n),s&&(n=n.replace(s,"")),i.lAjax=i.lBase+s,e=n.split("/").filter(function(t){return""!==t}).slice(-1),a.target=isNaN(e=parseInt(e))?1:e,i.animateTarget("paged",a,!0)}).on("click","#add-more-button",function(t){$(this).hasClass("active")||(t.preventDefault(),$(this).addClass("active"),i.ajax("more"))}).on("click","a.et_pb_video_play, div.et_pb_video_overlay",function(e){e.preventDefault(),e.stopImmediatePropagation();var i=$(this).hasClass("et_pb_video_overlay")?$(this):$(this).closest("div.et_pb_video_overlay");t.et_pb_play_overlayed_video(i)}),this.navBar.on("mouseenter","li.parent",function(){i.width<768&&($(this).hasClass("opened")?$(this).removeClass("opened").children("ul.first").fadeOut(400):$(this).addClass("opened").children("ul.first").fadeIn(400))}),$(document).on("click","a.dfbm-lb-link, a.dfbm-lb-read-more",function(t){t.preventDefault();var e=i.getSession("dfbmScrollPos");i.removeSession("dfbmScrollPos"),i.setScrollPos(e,$(this).prop("href"))}),$(t).on("resize",function(){i.catNavSubmenu(),i.width=$(t).width(),i.catNavPadding(),i.headH=i.header(),i.width>767&&i.featured(),i.grid?i.videoWidth(!0):i.fullwidth()}).on("popstate",function(){if(i.getSession("dfbmRedirect")||i.getSession("dfbmAddMore"))var t=setInterval(function(){i.getSession("dfbmRedirect")||i.getSession("dfbmAddMore")||(clearInterval(t),i.checkState())},100);else i.checkState()})}}),new e({})})}(jQuery,window);
//# sourceMappingURL=./dfbm-blogthread.min.js.map