"use strict";/**
 * Mosaic Flow
 *
 * Pinterest like responsive image grid that doesnâ€™t sucks
 *
 * @requires jQuery
 * @author Artem Sapegin
 * @copyright 2012 Artem Sapegin, http://sapegin.me
 * @license MIT
 *
 * This is a custom version of this plugin, to work nicely with Divi and the Plugin "Divi - Filterable Blog Module" by Bruno Bouyajdad from https://indikator-design.com
 *
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function($){function t(t,i){this.container=t,this.options=i,this.container.trigger("mosaicflow-start"),this.init(),this.container.trigger("mosaicflow-ready")}function i(t){function i(t,i){return i.toUpper()}var s={},e=t.data();for(var n in e)s[n.replace(/-(\w)/g,i)]=e[n];return s}function s(t){var i={};if(i.height=parseInt(t.attr("height"),10),i.width=parseInt(t.attr("width"),10),0===i.height||0===i.width){var s=new Image;s.src=t.attr("src"),i.width=s.width,i.height=s.height}return i}var e=0;$.fn.mosaicflow=function(s){var e=Array.prototype.slice.call(arguments,0);return this.each(function(){var n=$(this),o=n.data("mosaicflow");o?"string"==typeof s&&o[s](e[1]):(s=$.extend({},$.fn.mosaicflow.defaults,s,i(n)),o=new t(n,s),n.data("mosaicflow",o))})},$.fn.mosaicflow.defaults={itemSelector:"> *",columnClass:"mosaicflow__column",minItemWidth:240,minColumns:2,itemHeightCalculation:"auto",threshold:40},t.prototype={init:function t(){this.__uid=e++,this.__uidItemCounter=0,this.items=this.container.find(this.options.itemSelector),this.columns=$([]),this.columnsHeights=[],this.itemsHeights={},this.tempContainer=$('<div class="tempContainer">').css({visibility:"hidden",width:"100%"}),this.workOnTemp=!1,this.autoCalculation="auto"===this.options.itemHeightCalculation,this.container.after(this.tempContainer);var i=this;this.items.each(function(){var t=$(this),s=t.attr("id");s||(s=i.generateUniqueId(),t.attr("id",s))}),this.container.css("visibility","hidden"),this.refill(),$(window).resize($.proxy(this.refill,this))},refill:function t(){this.container.trigger("mosaicflow-fill"),this.numberOfColumns=Math.floor(this.container.width()/this.options.minItemWidth);var i=parseInt(dfbmPhp.cMax);$(window).width()<768&&(this.numberOfColumns=1),$(window).width()>767&&this.numberOfColumns<2&&(this.numberOfColumns=2),$(window).width()>767&&this.numberOfColumns>i&&(this.numberOfColumns=i),this.numberOfColumns<this.options.minColumns&&(this.numberOfColumns=this.options.minColumns),this.ensureColumns()&&(this.fillColumns(),this.columns.filter(":visible").length>0&&this.columns.filter(":hidden").remove()),window.sessionStorage.getItem("dfbmAddMore")||window.sessionStorage.getItem("dfbmRedirect")||(this.container.trigger("adjust-scroll-top"),this.container.addClass("completed").css("visibility","visible").parent().addClass("completed")),this.container.trigger("mosaicflow-filled")},ensureColumns:function t(){var i=this.columns.filter(":visible").length,s=this.numberOfColumns;if(this.workingContainer=0===i?this.tempContainer:this.container,s>i)for(var e=s-i,n=0;n<e;n++){var o=$("<div>",{class:this.options.columnClass});this.workingContainer.append(o)}else if(s<i){for(var h=i;s<=h;)this.columns.eq(h).hide(),h--;var r=i-s;this.columnsHeights.splice(this.columnsHeights.length-r,r)}return s!==i&&(this.columns=this.workingContainer.find("."+this.options.columnClass),this.columns.css("width",100/s+"%"),!0)},fillColumns:function t(){for(var i=this.numberOfColumns,s=this.items.length,e=0;e<i;e++){var n=this.columns.eq(e);this.columnsHeights[e]=0;for(var o=e;o<s;o+=i){var h=this.items.eq(o),r=0;n.append(h),r=this.autoCalculation?h.outerHeight():parseInt(h.find("img").attr("height"),10),this.itemsHeights[h.attr("id")]=r,this.columnsHeights[e]+=r}}this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.workingContainer===this.tempContainer&&this.container.append(this.tempContainer.children()),this.container.trigger("mosaicflow-layout")},levelBottomEdge:function t(i,s){for(;;){var e=$.inArray(Math.min.apply(null,s),s),n=$.inArray(Math.max.apply(null,s),s);if(e===n)return;var o=this.columns.eq(n).children().last(),h=i[o.attr("id")],r=s[e],a=s[n],l=r+h;if(l>=a)return;if(a-l<this.options.threshold)return;this.columns.eq(e).append(o),s[n]-=h,s[e]+=h}},add:function t(i){this.container.trigger("mosaicflow-item-add",[i]);var e=$.inArray(Math.min.apply(null,this.columnsHeights),this.columnsHeights),n=0;if(this.autoCalculation){i.css({position:"static",visibility:"hidden",display:"block"}).appendTo(this.columns.eq(e)),n=i.outerHeight();var o=i.find("img");0!==o.length&&o.each(function(){var t=$(this),i=s(t),e=t.width()*i.height/i.width;n+=e}),i.detach().css({position:"static",visibility:"visible"})}else n=parseInt(i.find("img").attr("height"),10);i.attr("id")||i.attr("id",this.generateUniqueId()),this.items.push(i[0]),this.itemsHeights[i.attr("id")]=n,this.columnsHeights[e]+=n,this.columns.eq(e).append(i),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("mosaicflow-item-added",[i])},remove:function t(i){this.container.trigger("mosaicflow-item-remove",[i]);var s=i.parents("."+this.options.columnClass);this.columnsHeights[s.index()-1]-=this.itemsHeights[i.attr("id")],i.detach(),this.items=this.items.not(i),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("mosaicflow-item-removed",[i])},empty:function t(){var i=this.numberOfColumns;this.items=$([]),this.itemsHeights={};for(var s=0;s<i;s++){var e=this.columns.eq(s);this.columnsHeights[s]=0,e.empty()}this.container.trigger("mosaicflow-layout")},recomputeHeights:function t(){function i(t,i){i=$(i);var e=0;e=s.autoCalculation?i.outerHeight():parseInt(i.find("img").attr("height"),10),s.itemsHeights[i.attr("id")]=e,s.columnsHeights[n]+=e}for(var s=this,e=this.numberOfColumns,n=0;n<e;n++){var o=this.columns.eq(n);this.columnsHeights[n]=0,o.children().each(i)}},generateUniqueId:function t(){return this.__uidItemCounter++,"mosaic-"+this.__uid+"-itemid-"+this.__uidItemCounter}}});
//# sourceMappingURL=./dfbm-masonry.min.js.map