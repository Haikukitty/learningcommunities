"use strict";!function($,t){$(function(){var e=function t(e){this.init(e)};$.extend(e.prototype,{init:function t(e){this.vars(e),this.events(),this.load()},vars:function t(e){this.opt=$.extend({header:"",content:"",more:"",close:"Close",addAfter:"body",selector:"",width:"80%",data:{}},e),this.top,this.lightbox=this.structure(),this.imgData=this.opt.data,this.addAfter=$(this.opt.addAfter),this.selector=this.opt.selector?", "+this.opt.selector:""},structure:function t(){return $(['<div id="dfbm-lightbox">','<div id="dfbm-lb-pop" class="dfbm-lb-pop dfbm-closed"></div>','<div id="dfbm-lb-wrap" class="dfbm-lb-wrap">','<div class="dfbm-lb-container">','<div class="dfbm-lb-slider" style="width:'+this.opt.width+';">','<div id="dfbm-lb-holder" class="dfbm-lb-holder dfbm-closed">','<div id="dfbm-lb-outer" class="dfbm-lb-outer">','<div class="dfbm-lb-header-section">',this.opt.header?'<h3 class="dfbm-lb-header">'+this.opt.header+"</h3>":"",'<a href="#" id="dfbm-lb-close" class="dfbm-lb-close">'+this.opt.close+"</a>","</div>",this.slide(this.opt.content),"</div>","</div>","</div>","</div>","</div>","</div>"].join("\n"))},slide:function t(e,i){var t=[],i=i||!1,s=null!=e.video?e.video:this.image(e)+'<div class="dfbm-lb-switch prev" data-direction="prev"><span></span></div><div class="dfbm-lb-switch next" data-direction="next"><span></span></div>';return t=['<div class="dfbm-lb-content-section'+(i?" hidden":"")+'">','<div class="dfbm-lb-content">',s,"</div>",'<div class="dfbm-lb-footer-section">','<a class="dfbm-lb-link" href="'+e.href+'">','<div class="dfbm-lb-title">'+e.title+"</div>","</a>",'<a class="dfbm-lb-read-more" href="'+e.href+'">','<div class="dfbm-lb-title">'+this.opt.more+"</div>","</a>","</div>","</div>"].join("\n")},image:function t(e){return'<img src="'+e.src+'" alt="'+e.title+'">'},addSlide:function t(e){var i=this,s=$("#dfbm-lb-outer");s.css("minHeight",s.outerHeight()).children("div").addClass("hidden"),setTimeout(function(){s.children("div.dfbm-lb-content-section").remove(),s.append(i.slide(i.imgData.images[i.imgData.show],!0)),s.find("img").load(function(){s.css("minHeight","100%").children("div").removeClass("hidden")})},200)},load:function e(){this.top=$(t).scrollTop(),t.sessionStorage.setItem("dfbmScrollPos",this.top),this.lightbox.insertAfter(this.addAfter.addClass("lightbox").css("top",-this.top)),null!=this.opt.content.video&&this.videoRatio(),this.animate("in")},animate:function e(i){var s=$("#dfbm-lb-pop"),o=$("#dfbm-lb-holder");switch(i){case"in":setTimeout(function(){s.addClass("dfbm-opened").removeClass("dfbm-closed")},0),setTimeout(function(){o.addClass("dfbm-opened").removeClass("dfbm-closed")},300);break;case"out":o.addClass("dfbm-closed").removeClass("dfbm-opened"),setTimeout(function(){s.addClass("dfbm-closed").removeClass("dfbm-opened"),t.sessionStorage.removeItem("dfbmScrollPos")},300);break}},videoRatio:function e(){var i=$("#dfbm-lightbox").find("video.wp-video-shortcode, iframe"),s=i.outerWidth()/i.outerHeight(),o=.9*$(t).width(),d=.9*$(t).height(),n=d*s>o?o/s:d,a=n*s,r={height:n,width:a},l=i.closest("div.wp-video").css(r),h=l.closest("div.dfbm-lb-slider").css("width",a);null==t.wp.mediaelement||this.opt.content.elem?i.css(r):i.css(r).mediaelementplayer()},position:function t(e){var i,s=this.imgData.show,o=Object.keys(this.imgData.images).length;return i=~~("next"==e)||-1,s+=i,this.imgData.show=s<0?o-1:s%o,i},events:function e(){var i=this;$(document).on("click","#dfbm-lb-close",function(e){return e.preventDefault(),i.addAfter.removeClass("lightbox").scrollTop(i.top),$(t).scrollTop(i.top),i.animate("out"),setTimeout(function(){$(document).off("click","div.dfbm-lb-switch"),$("#dfbm-lightbox").detach()},600),!1}),$(document).on("click","div.dfbm-lb-switch",function(t){var e=i.position($(this).data("direction"));i.addSlide(e)})}});var i=function t(e){this.init(e)};$.extend(i.prototype,{init:function t(e){this.vars(),this.events()},vars:function t(){this.url=dfbmPhp.url,this.nonce=dfbmPhp.nonce,this.cdn=dfbmPhpLB.cdn,this.parent=$("#dfbm-container"),this.blog=this.parent.children("div.filterable-blogposts"),this.grid=!!this.parent.hasClass("grid")},lightbox:function t(i){var s=null!=i.video?i:i.images[i.show],o=new e({selector:"",data:i,content:s,addAfter:"body",header:dfbmPhpLB.header,close:dfbmPhpLB.close,width:dfbmPhpLB.width+"%",more:dfbmPhpLB.more})},getdirChildImg:function t(e,i){var s={},o={};return e.each(function(t){var e,d,n,a;(e=$(this).children("img")).length>0&&(d=$(this).prop("href"),a=i==d,s[t]={src:e.prop("src").replace(/[_-]\d+x\d+(?=\.[a-zA-Z]{3,4}$)/i,""),title:$(this).data("title"),href:d},a&&(o.show=t))}),o.images=s,o},getImages:function t(e){var i={},s=[],o,d,n,a,r,l;if(a=this.getdirChildImg($("#et_pb_featured_posts").find("a.entry-featured-image-url"),e),i.images=a.images,null!=a.show&&(i.show=a.show),this.grid)for(d=this.blog.children("div"),d.each(function(t){s[t]=$(this).find("article").length}),n=Math.max.apply(Math,s),o=0;o<n;o++)for(var h=0;h<d.length;h++){var c=$(d[h]).find("article").eq(o),f={},m;if((m=c.find("img")).length>0){var b=c.find("a.entry-featured-image-url"),p=b.prop("href"),v=e==p?1:0;l=Object.keys(i.images).length,f={src:m.prop("src").replace(/[_-]\d+x\d+(?=\.[a-zA-Z]{3,4}$)/i,""),title:b.data("title"),href:p},i.images[l]=f,v&&(i.show=l)}}else{for(r=this.getdirChildImg(this.blog.find("a.entry-featured-image-url"),e),l=Object.keys(i.images).length,o=0;o<Object.keys(r.images).length;o++)i.images[l+o]=r.images[o];null!=r.show&&(i.show=r.show+l)}this.lightbox(i)},getGallery:function t(e){var i={},s,o=e.find("div.et_pb_slide"),d=e.find(".entry-title a"),n=d.prop("href"),a=d.text();i.images={},o.each(function(t){s=$(this).css("background-image").trim(),s=s.replace(/(url\(|\)|'|")/gi,""),i.images[t]={src:s,href:n,title:a}}),i.show=0,this.lightbox(i)},getVideo:function t(e){var i={},s=e.find("div.et_pb_video_overlay").addClass("lightbox"),o=e.find(".entry-title a"),d=e.find("video.wp-video-shortcode a, iframe");if(i.title=o.text(),i.href=o.prop("href"),i.elem=~~d.is("iframe"),i.link=i.elem?d.prop("src"):d.prop("href"),i.elem){var n=d.prop("src")+"&autoplay=1";return i.video=d.clone(!0).removeAttr("width height style").prop("src",n).prop("outerHTML"),this.lightbox(i)}this.ajax(i)},ajax:function t(e){var i=this,s={nonce:this.nonce,action:"dfbm_get_video",vidLink:e.link,cdn:this.cdn};$.ajax({type:"post",dataType:"json",url:this.url,data:s,success:function t(s){e.video=s,i.lightbox(e)},error:function t(e){location.reload()}})},events:function t(){var e=this;this.parent.on("mousedown","a.entry-featured-image-url",function(t){t.preventDefault(),t.stopPropagation(),e.getImages($(this).prop("href"))}).on("mousedown","div.et_pb_slider",function(t){t.preventDefault(),t.stopPropagation(),e.getGallery($(this).closest("div.article-inner"))}).on("mousedown","div.et_main_video_container",function(t){t.preventDefault(),t.stopPropagation(),$(this).find(".et_pb_video_overlay").off(),e.getVideo($(this).parent("div.article-inner"))})}}),new i({})})}(jQuery,window);
//# sourceMappingURL=./dfbm-lightbox.min.js.map